\chapter{Metodologia Proposta para Restabelecimento Automático de Energia Elétrica\label{cap:metodologia}}

%\textbf{Modelo do sistema, diagrama de comunicação,  fluxogramas de tomada de decisão}
%%%EXPLICAR MELHOR QUAL O OBJETIVO DO
Esse capítulo descreve a metodologia desenvolvida para restabelecimento automático com o uso de chaves telecomandadas. A criação de tal metodologia teve como meta a definição de um conjunto de ações universais que possam ser aplicadas a diferentes topologias de redes de distribuição radial, tendo como função objetivo o restabelecimento do máximo de consumidores após um defeito permanente, sem que isso ocasione sobrecargas no sistema de distribuição.



\section{Caracterização e Modelagem do Problema \label{sec:modelagem_problema}}

%\textbf{Descrever/modelar o problema, Aqui entram as restrições/objetivo????}

% \textbf{Qual é o problema?}
Como foi apresentado no capítulo 3, a automação da rede de distribuição pode reduzir o tempo de interrupção de energia elétrica para os consumidores. O uso de um sistema computacional inteligente pode reduzir ainda mais esse tempo, uma vez que tal sistema pode analisar todas as possibilidades de manobras e executar as simulações necessárias para cada uma das possibilidade enumeradas de forma automática, apresentando ao final o melhor conjunto de manobras, tudo isso em questão de poucos instantes. Quando a metodologia apresenta o melhor conjunto de manobras como resultado de seu processamento, essas manobras são melhores que as demais com base em algum objetivo específico e porque não violam as restrições impostas. Neste trabalho, esse objetivo será tentar restabelecer o número máximo de consumidores e ele irá direcionar as escolhas feitas pelo sistema computacional, ou seja, qual é a melhor manobra dentre um conjunto de opções. As restrições devem ser definidas para que as manobras apresentadas pelo sistema 
sejam respostas factíveis, ou seja, que tais respostas possam ser aplicadas a realidade de uma rede de distribuição.

%Descrever a modelagem da rede de distribuição com um grafo e definir a representação do estado das chaves como sendo binárias. Depois modelar o sistema função objetivo e restrições.


% \textbf{Que restrições consideramos?}
Para representar as rede de distribuição, foi escolhida a representação através de um grafo não orientado, onde as arestas representam os elementos de conexão como condutores e chaves, e os vértices representam os pontos de carga ou sustentação da rede (para um modelo mais detalhado). Essa escolha foi feita por permitir uma implementação computacional mais eficaz e também uma formulação matemática que represente o problema. As resposta apresentadas por essa metodologia não devem provocar danos, por exemplo, uma manobra que sobrecarregue um condutor a ponto de rompê-lo. Para isso, a metodologia utilizará a seguinte função objetivo e restrições de operação da rede, as quais foram baseadas no trabalho de \cite{Garcia2005}:

\begin{eqnarray}
\min && \sum_{i \in CC}{(1-Z_{i})NC_{i}}  \label{eq:objetivo} \\
\textrm{sujeito a:} && \nonumber \\
&& X_i + X'_i \leq 1\textrm{ , para } i = 1, ..., M\label{eq:uso1aresta1} \\
&& Y_i + Y'_i \leq 1\textrm{ , para } i = 1, ..., M \label{eq:uso1aresta2}\\
&& \sum_{k \in B_{k}}(X_i + X'_i + Y_i + Y'_i) \leq 1 \textrm{ , para } k = 1, 2,\ldots, N \label{eq:radialidade} \\
% && \sum_{i \in F_k}{(P_i + P'_i)} - \sum_{i \in B_k}{(P_i + P'_i}) = L_k Z_k \textrm{ , para } k = 1, 2,\ldots, N \label{eq::fluxo} \\
&& I_k - IL_kX_k \leq 0 \textrm{ , para } k = 1, 2,\ldots, M \label{eq:capacidadeArestas1} \\
&& I'_k - IL_kX'_k \leq 0 \textrm{ , para } k = 1, 2,\ldots, M \label{eq:capacidadeArestas2} \\
&& I_k - IL_kY_k \leq 0 \textrm{ , para } k = 1, 2,\ldots, M \label{eq:capacidadeArestas3} \\
&& I'_k - IL_kY'_k \leq 0 \textrm{ , para } k = 1, 2,\ldots, M \label{eq:capacidadeArestas4} \\
&& V_{min} \leq \sqrt{L_kZ_kR_k} \leq V_{max} \textrm{ , para } k = 1, 2,\ldots, N \label{eq:tensao}
\end{eqnarray}


Onde:
\begin{description}
    \item[$N$] - Número de nós na rede;
    \item[$M$] - Número de arestas na rede;
    \item[$I_{k}$] - Corrente no ramo $k$;
    \item[$I'_{k}$] - Corrente no ramo fictício $k$;
    \item[$Z_k$] - Indica se o nó está sendo alimentado ($Z_i=1$) ou não ($Z_i=0$);
    \item[$IL_k$] - Capacidade de fluxo na aresta $k$;
    \item[$R_k$] - Impedância do nó $k$;
    \item[$L_k$] - Demanda do nó $k$;
    \item[$B_k$] - Conjunto de todas arestas com o nó $k$ como início;
    \item[$F_i$] - Conjunto de todas arestas com o nó $i$ como fim;
    \item[$CC$] - Conjunto de nós consumidores;
    \item[$NC_i$] - Número de consumidores no nó $i$;
    \item[$X_i$] - Indica se a chave normalmente fechada do ramo $i$ está fechada ($X_i = 1$) ou aberta ($X_i=0$) na solução final;
    \item[$X'_i$] - Indica se a chave normalmente fechada do ramo fictício $i$ está fechada ($X'_i = 1$) ou aberta ($X'_i=0$) na solução final;
    \item[$Y_i$] - Indica se a chave normalmente aberta do ramo $i$ está fechada ($Y_i = 1$) ou aberta ($Y_i=0$) na solução final;
    \item[$Y'_i$] - Indica se a chave normalmente aberta do ramo fictício $i$ está fechada ($Y'_i = 1$) ou aberta ($Y'_i=0$) na solução final;
    \item [$V_{min}$] - Módulo da tensão mínima aceitável na rede;
    \item [$V_{max}$] - Módulo da tensão máxima aceitável na rede.
\end{description}

Como função objetivo (\ref{eq:objetivo}), foi definido que deseja-se minimizar o número de consumidores não restabelecidos, que é o mesmo que tentar restabelecer o máximo de consumidores. Em caso de empate (duas soluções restabeleçam o mesmo número de consumidores), como critério de desempate, será escolhida a manobra que tiver o menor carregamento máximo nos condutores. Deve-se notar o uso de arestas fictícias ($'$) para impedir que os valores de fluxos sejam negativos, nesse caso o valor do fluxo fica atribuído para aresta fictícia. Para garantir o uso de apenas uma dessas arestas, foram inseridas as restrições \ref{eq:uso1aresta1} e \ref{eq:uso1aresta2}.

A restrição \ref{eq:radialidade} garante que as manobras de restabelecimento não podem criar aneis na rede de distribuição. Essa restrição garante que não existirá mais de uma chave fechada incidente em um nó da rede.
% A forma como foi concebido o método de enumeração das manobras de transferência já cuida dessa restrição e o isolamento usando as chaves a montante do defeito não deve gerar nenhum ciclo também.

As restrições de carregamento dos condutores, \ref{eq:capacidadeArestas1}, \ref{eq:capacidadeArestas2}, \ref{eq:capacidadeArestas3} e \ref{eq:capacidadeArestas4}, garantem que não haverá sobrecarga nos mesmos. Para simplificar o modelo matemático e não precisar descrever o método do fluxo de carga, os valores de carga nas variáveis $I_k$ são atribuídos por um algoritmo externo de cálculo de fluxo de potência por somatório de correntes \cite{bernardon2004desenvolvimento}. Esse algoritmo foi implementado dentro de uma ferramenta computacional que será descrita no capítulo \ref{cap:casosestudos}.

Como o tempo em que a rede irá permanecer no estado de contingência é de poucas horas, pode ser permitido uma pequena carga acima do limite de operação dos condutores e um valor maior de carregamento nos equipamentos de proteção, mas não acima de sua corrente de atuação. Para simplificar o modelo, será considerado que os valores nas variáveis $IL_k$ já possuem esse valor incorporado. No decorrer do texto as referências a esses valores, que na metodologia são configuráveis, são referenciados como $F_{sobrecarga}$, que indica o quanto de sobrecarga será aceito nos condutores, $F_p$ indica o percentual de carregamento dos equipamentos de proteção.


Mesmo no estado de contingência é necessário manter a qualidade de energia disponibilizadas para os consumidores, assim as restrições \ref{eq:tensao} impõem os limites de tensão mínima e máxima. Essas restrições tem como principal objetivo evitar que manobras de transferência deixem os consumidores com uma tensão muito abaixo ou acima dos padrões estabelecidos.

A verificação do atendimento das restrições é executada para cada manobra indicada pela metodologia de restabelecimento. Para isso é necessário que sejam executadas as simulações de fluxo de potência nos alimentadores afetados pela manobra após a aplicação da mesma. Se alguma das restrições for violada, essa manobra é marcada como inválida e que não pode ser executada diretamente.

A solução que apresentamos aqui para esse problema de automatização do restabelecimento, é capaz de:
\begin{itemize}
\item Detectar a ocorrência de um defeito permanente (através de um SCADA);
\item Localizar a área a ser isolada (área defeituosa);
\item Definir um conjunto de manobras a serem executadas para restabelecer o máximo possível de consumidores através do isolamento e transferência de carga.
\end {itemize}

Para isso, essa metodologia faz uso de informações em tempo real obtidas de diferentes fontes para realizar simulações muito próximas da rede atual, e assim definir o conjunto de manobras a serem avaliadas.

A escolha dentre essas manobras é dada pela função objetivo, que prioriza as manobras que restabeleçam mais consumidores (usando o carregamento como desempate) e que não tenham violado nenhuma das restrições.

%\textbf{Exemplo de uma escolha entre manobras}
Para exemplificar a escolha da melhor manobra, considere as manobras de transferência fictícias apresentadas na Tabela \ref{tab:listaManobras}. Essas manobras são referentes ao trecho de rede apresentada na Figura \ref{fig:Exemplo_transferencia}. Aqui ainda não serão exploradas todas as possibilidades de manobras, isso será tratado na seção \ref{sec:AlgoritmoTomadaDecisao}. Os percentuais apresentados nos condutores, proteção e queda de tensão, são os carregamentos máximos e a maior queda de tensão apresentados durante as simulações, considerando os limites da rede. Como restrições, foram definidos os valores de sobrecarga dos condutores de 120\% ($F_{sobrecarga}=1.2$), carregamento de equipamentos de proteção 80 \% ($F_{p}=0.8$) e queda máxima de tensão de 7\% (em relação a tensão nominal, sendo nesse caso $V_{min} = V \cdot 0.93$ e $V_{max} = V \cdot 1.07$, onde $V$ é a tensão nominal da rede).

\begin{figure}[htb]
\centering
\includegraphics[width=0.5\columnwidth]{img/exemploTransferencias}

\caption{Exemplo de possíveis transferências de uma rede \label {fig:Exemplo_transferencia}}
\end{figure}

\begin{table}[htbp]
\caption{Exemplos de Manobras }
\begin{tabular}{|c|c|c|r|r|r|r|}
\hline
\multicolumn{1}{|l|}{Manobra} & \multicolumn{1}{l|}{Abrir} & \multicolumn{1}{l|}{Fechar} & \multicolumn{1}{l|}{Clientes} & \multicolumn{1}{l|}{Condutores (\%)} & \multicolumn{1}{l|}{Proteção (\%)} & \multicolumn{1}{l|}{Queda Tensão (\%)} \\ \hline
1 & CH1-A & NA-1 & 3000 & 90 & 105 & 3 \\ \hline
2 & CH1-A & NA-2 & 3000 & 95 & 70 & 8 \\ \hline
3 & CH1-B & NA-1 & 1000 & 80 & 90 & 4 \\ \hline
4 & CH2-B & NA-2 & 1500 & 75 & 50 & 3 \\ \hline
% 5 & CH-1 & NA-2 & 1400 & 88 & 35 & 3 \\ \hline
\end{tabular}
\label{tab:listaManobras}
\end{table}

Se apenas for analisado o número de consumidores restabelecidos, sem considerar as restrições, tanto a manobra número 1 quanto a número 2 seriam as melhores a serem aplicadas. Como o critério de desempate é o menor carregamento dos condutores, a manobra de número 1 seria escolhida. Agora se forem também consideradas as restrições definidas anteriormente, a manobra 1 não poderia ser executada, pois viola as restrições de carregamento dos equipamentos de proteção (limite é 80\%). Já a manobra 2 viola a queda de tensão. Outra manobra que viola ao menos uma das restrições é a manobra 3, que também viola o carregamento dos equipamentos de proteção.

A manobra restante (4) não viola nenhuma das restrições, sendo válida para ser aplicada diretamente. Dentre as manobras válidas, é escolhida a melhor delas, que poderá ser aplicada. A melhor manobra é aquela que restabelece o maior número de consumidores. Como não existem outras possibilidades, a única manobra que poderia ser executada diretamente é a manobra 4.

Referente as manobras de isolamento (abertura da chave a montante do defeito e religamento do equipamento atuado), elas não devem violar nenhuma restrição, já que a rede volta a ter sua topologia anterior com uma redução da carga após a chave a montante do defeito, ou seja, a carga total do alimentador diminuirá, reduzindo também o carregamento dos condutores e equipamentos de proteção. Para essas manobras, também se aplica a escolha por manobras que restabeleçam o máximo de consumidores, sendo que isso é garantido pela escolha do equipamento mais próximo ao defeito como equipamento a ser manobrado. Na seção \ref{sec:metodo_proposto} é explicado como a metodologia consegue fazer essa escolha de manobra.

A seguir é detalhada a arquitetura proposta para implementação dessa metodologia, ou seja, quais são os sistemas necessários para adquirir informações em tempo real sobre o sistema de distribuição e como a metodologia se comunica com eles.

\section{Arquitetura do Sistema\label{sec:arquiteturaSistema}}
Para implementar a metodologia, é necessário o acesso em tempo real a algumas informações como o estado de comunicação das chaves telecomandadas, o qual é obtido através do SCADA, o cadastro da rede (topologia original, cargas, tipos de condutores,etc), o estado atual de todos equipamentos de manobra, além do acesso ao histórico de carregamento dos alimentadores. 

Com base nessas necessidades, foi proposta a arquitetura de sistema apresentada na Figura \ref{fig:Arquitetura_sistema}, onde existem 4 fontes de dados (Estado das Chaves, Histórico de carga, SCADA e Cadastro da Rede) e o sistema computacional, o qual implementa a metodologia aqui descrita. O sistema Estado das Chaves mantém um banco de dados onde se encontra o estado atualizado de todas as chaves, tal informação é importante uma vez que a rede pode ter sido reconfigurada em relação a topologia inicial descrita no Cadastro da Rede, sendo essa alteração proveniente de um defeito ou mesmo para isolar alguma área para
manutenção preventiva. O Histórico de carga armazena as leituras de corrente dos alimentadores, sendo então possível estimar o comportamento da carga nas próximas horas com base no comportamento passado, como será melhor detalhado ainda neste capítulo.

\begin{figure}[htbp]
\centering
\includegraphics[width=0.7\columnwidth]{img/ArquiteturaSistema}

\caption{Arquitetura proposta para o sistema computacional\label{fig:Arquitetura_sistema}}

\end{figure}


Quando um defeito na rede de distribuição faz com que algum equipamento telecomandado entre em bloqueio, o SCADA comunica esse fato através de um evento, que nada mais é do que um sinal computacional que pode ser capturado e tratado por outros sistemas, contanto que estejam registrados no servidor do sistema supervisório. Tal  evento é uma indicação de que aconteceu, por exemplo, a mudança de estado de aberto para fechado ou vice versa, e com qual equipamento isso aconteceu, normalmente indicado pela sua matrícula. 

A ocorrência do bloqueio de algum equipamento telecomandado, é o gatilho que dá início aos procedimentos de restabelecimento do fornecimento de energia elétrica utilizando a metodologia proposta. Tais procedimentos têm início com a atualização da topologia da rede, usando o cadastro do Estado das chaves, seguido do ajuste da carga, o qual usa uma previsão para as próximas horas da corrente máxima de carga para  ajustar a demanda dos consumidores. Antes de continuar com o procedimento de seleção das manobras, é verificado no sistema SCADA o estado de comunicação das chaves que podem ser utilizadas para executar o restabelecimento, bem como outras informações que serão melhor detalhadas a seguir. 

% As chaves que apresentarem o estado de comunicação bom, poderão ser utilizadas para executar as simulações para o restabelecimento automatizado. Dentre essas chaves são importantes as chaves que fazem parte do alimentador atingido pelo defeito e as chaves de fronteira desse alimentador com o alimentador vizinho.

Com a topologia da rede atualizada, são selecionados os equipamentos telecomandados que comporão o conjunto de equipamentos que podem ser usadas nas manobras. Tais equipamentos pertencem ao alimentador onde ocorreu o defeito e os equipamentos de fronteira entre esse alimentador e seus vizinhos.

Com tal conjunto o sistema computacional solicita ao SCADA as seguintes informações sobre cada uma das chaves que podem ser utilizadas nas manobras:
\begin{itemize}
 \item Estado do equipamento (aberto/fechado): esse valor sobrepõe o valor do banco de estado das chaves por ser mais atual (tempo real);
 \item Estado de comunicação: Chaves com falhas na comunicação são excluídas do restante do processo de definição das manobras;
 \item Inclusão/exclusão: Se uma chave está excluída significa que ela não pode ser religada nem manobrada;
 \item Sinalizações das fases: Os equipamentos quando configurados como chaves sobcarga não desarmam quando atravessados pela corrente de curto-circuito, mas guardam quais fases foram afetadas por tal corrente.
\end{itemize}

Normalmente as chaves são marcadas que não podem ser utilizadas (excluídas) quando existem equipes trabalhando com rede viva (energizada) ou por qualquer outra razão que a chave não deva ser operada, assim, se qualquer equipamento pertencente ao conjunto de chaves estiver excluído, todo processo de restabelecimento é cancelado, uma vez que isso pode envolver questões de segurança dos trabalhadores.

Após essas atualizações, é aplicado o procedimento de seleção das chaves que devem ser manobradas e, por fim, são enviados ao SCADA os comandos das chaves (Abrir ou Fechar) que devem ser executados a fim de restabelecer o máximo de consumidores. A Figura \ref{fig:ComunicacoesSistemas} apresenta o diagrama de sequência em que essas trocas de informações acontecem.

\begin{figure}[htbp]
\centering
\includegraphics[width=0.7\columnwidth]{img/SystemsComm}

\caption{Diagrama de sequência de comunicação entre sistemas\label{fig:ComunicacoesSistemas}}

\end{figure}

%Nas seções a seguir, são apresentados maiores detalhes sobre as operações de atualização de carga do sistema, considerando o horizonte de algumas horas à frente, e sobre o procedimento de escolha das melhores manobras a serem executadas.

%% Remover essa seção
%\section{Atualização de carga}
A necessidade de ajustar as demandas dos consumidores pertencentes ao alimentador afetado pelo defeito e seus vizinhos, reside no fato que se houver alguma simulação de manobra de transferência de carga do primeiro para um de seus vizinhos, a mesma deve ser feita com uma carga muito próxima do estado real dos alimentadores, evitando assim que alguma manobra sugerida provoque algum problema de sobrecarga. Como o estado de contingência pode durar algumas horas, até que o defeito seja resolvido, a rede terá que ficar no estado manobrado durante esse período. O ajuste de carregamento é executado com a carga máxima nas próximas horas evitando que existam problemas de sobrecarga caso a demanda cresça durante o período de contingência.

Para calcular essa carga máxima é feita uma estimativa com base no histórico de carga da semana anterior para cada um dos alimentadores envolvidos. É analisada a tendência da carga nas próximas horas, e depois a carga atual, que é a corrente antes do defeito ou pré-falta, é ajustada segundo esse valor. A tendência de crescimento é sempre a do pior cenário do histórico, assim, ou a corrente de carga aumenta, ou se mantém estável, sendo esse último caso quando a carga está diminuindo e a maior carga do sistema é a atual. A seguir são apresentas as equações para determinação da tendência da carga e de ajuste da carga pré-defeito para o pior patamar. A Equação \ref{eq:Historico_carga}  mostra o cálculo do ajuste da carga com base no histórico da semana anterior considerando $n$ horas a frente e a Equação \ref{eq:Ajuste_carga} o ajuste da carga pré-defeito de um alimentador.

\begin{eqnarray}
 A_{carga} &=& \frac{Max(H_{h}, H_{h+1}, \cdots , H_{h+n})}{H_{h}} \label{eq:Historico_carga}\\
 C_{prev} &=& C_{p} \cdot A_{carga} \label{eq:Ajuste_carga}
\end{eqnarray}
Onde:
\begin{itemize}
  \item $H_{h}$: Valor de carga de um dado alimentador a uma semana atrás na hora h;
  \item $h$: Hora da ocorrência do defeito (atual);
  \item $C_{p}$: Carga pré-defeito do alimentador em questão;
  \item $C_{prev}$: Carga máxima prevista para o alimentador no horizonte de n horas a frente;
  \item $A_{carga}$: Ajuste a ser aplicado na carga. Esse valor é sempre maior ou igual a 1.
\end{itemize}

O ajuste das demandas dos consumidores é relativo a carga prevista e a carga simulada através de um algoritmo de fluxo de potência como foi dito na seção \ref{sec:modelagem_problema}. É necessário executar os ajustes das potências ativa e reativa demandada pelos consumidores na mesma proporção da carga prevista pela simulada. Assim se a carga prevista for o dobro da carga simulada, a potência ativa e reativa de cada consumidor é duplicada também.

Após a atualização da topologia da rede e de suas cargas, o sistema computacional está pronto para computar as manobras que devem ser realizadas para isolar o defeito e restabelecer os demais consumidores. Na próxima seção é apresentada a metodologia de seleção das manobras a serem executadas.

\section {Método Proposto para Seleção das Configurações \label{sec:metodo_proposto}}

O método que será detalhado nessa seção faz parte da metodologia proposta e tem como papel indicar que chaves devem ser operadas para isolar o defeito. Esse método irá cuidar do isolamento do defeito da rede a montante do mesmo, além de enumerar as possibilidades de manobras para transferir os consumidores a jusante do defeito. A execução desse método se dá após as atualizações de estados e cargas, uma vez que os resultados obtidos dependem da maior fidelidade da rede simulada com a rede real.

Esse método é a parte principal da metodologia de restabelecimento automático, já que é ele que irá detectar a localização do defeito e com isso gerar as soluções de restabelecimento. Ele é composto de algumas etapas que podem ser visualizadas na Figura \ref{fig:Fluxograma_decisao}.


\begin{figure}[htb]
\begin{centering}
% \includegraphics[width=0.5\columnwidth]{img/FluxogramaChaves}
\begin{tikzpicture}[node distance = 4cm,auto, scale=0.5]
    % Place nodes
    \node [block] (start) {a) Desarme de equipamento telecomandado. Atualização de estados};
    \node [decision, below of=start,] (checkFlags) {b) Existem equipamentos sinalizados?};
    \node [block, left of=checkFlags, node distance = 6cm ] (findFlaged) {c) Encontre as chaves sinalizadas mais a jusante do equipamento atuado};
    \node [block, below of=findFlaged] (isolate) {d) Abrir tais chaves e rearme do equipamento atuado};
    \node [block, below of=checkFlags] (findOptions) {e) Encontre as opções de transferência após defeito};
    \node [block, below of=findOptions, node distance = 3cm] (choseBest) {f) Envio das melhores opções de transferência};


    % Draw edges
    \path [line] (start) -- (checkFlags);
    \path [line] (checkFlags)   -- node [midway] {Sim} (findFlaged);
    \path [line] (findFlaged) -- (isolate);
    \path [line] (isolate) --  (findOptions);
    \path [line] (checkFlags) -- node [midway] {Não} (findOptions);
    \path [line] (findOptions) -- (choseBest);
\end{tikzpicture}
\par\end{centering}
\caption{Método de seleção de manobras\label{fig:Fluxograma_decisao}}

\end{figure}

A parte inicial do método (\ref{fig:Fluxograma_decisao}-a) compreende as ações de desarme de um equipamento telecomandado e comunicação com os sistemas SCADA, de estado da rede e a obtenção da previsão de carga, a qual será utilizada para ajuste da rede. Essa etapa foi descrita nas seções anteriores, mas basicamente trata do início da metodologia devido a algum desarme e da atualização das informações da rede com dado mais próximos da hora do evento. Ressalta-se novamente que essas atualizações são importantes para se obter o estado da rede simulada o mais próximo do estado atual real da mesma.

Com as informações sobre o estado das chaves da rede atualizados, o método procura se alguma chave foi sinalizada como tendo sido atravessada pela corrente de curto-circuito, isso definirá se é possível isolar o defeito e restabelecer os consumidores a montante do mesmo.

Essa procura é feita na etapa \ref{fig:Fluxograma_decisao}-b, onde todos os equipamentos telecomandados, que pertencem ao alimentador do equipamento desarmado, que tenham sido sinalizados em qualquer uma das fases, são colocados em um conjunto.

Se existir algum equipamento nesse conjunto, significa que a corrente de curto-circuito passou por diversos equipamentos e que o defeito não está localizado logo após o equipamento desarmado, mas sim mais a montante da rede. Para encontrar o primeiro equipamento que foi atravessado pela corrente de curto-circuito, ou seja, o que se encontra logo antes do defeito, o método agora procura no conjunto de equipamentos sinalizados o que está mais a montante do equipamento atuado. Para isso é utilizada a topologia original da rede (anterior ao desarme). Essa busca pelo equipamento sinalizado mais a montante corresponde a etapa \ref{fig:Fluxograma_decisao}-c. Com o equipamento encontrado na etapa anterior, o método agora define a manobra de isolamento que consiste da abertura do equipamento sinalizado mais a montante e o fechamento do equipamento desarmado.

% Ainda utilizando a topologia original, a rede é percorrida. %%%ISOLAMENTOS MULTIPLOS%%%

A próxima etapa (\ref{fig:Fluxograma_decisao}-d) é o envio dos comandos para o SCADA.  Esses comandos de restabelecimento dos consumidores antes do defeito podem ser executados diretamente, pois isso não irá interferir no cálculo das transferências para os alimentadores vizinhos. É importante que a manobra de fechamento do equipamento atuado somente aconteça após a confirmação da abertura do equipamento sinalizado escolhido no passo anterior. Isso é necessário porque fechar o equipamento desarmado sem ter aberto o outro iria restabelecer o fornecimento com o defeito ainda presente na distribuição, o que poderia levar a um novo desarme do equipamento atuado anteriormente ou mesmo o desarme de outro equipamento. Nesse ponto, os consumidores a montante do defeito tiveram seu fornecimento restabelecido. Concluida essa operação, o método prossegue agora tentando executar a transferência para alimentadores vizinhos dos consumidores localizados após o defeito. Essa parte do método independe se houve equipamentos sinalizados ou não, ou seja, mesmo que o método já tivesse restabelecido os consumidores a montante do defeito o método irá analisar as possibilidades de transferência.

A análise de transferência inicia com o passo \ref{fig:Fluxograma_decisao}-e onde são procuradas todas possibilidades de transferência de carga para os alimentadores vizinhos e tem continuidade com passo \ref{fig:Fluxograma_decisao}-f, onde é feita a análise de tais possibilidades para decidir quais restabelecem mais consumidores e devem ser executadas.  Essas etapas serão apresentadas na próxima seção (\ref{sec:AlgoritmoTomadaDecisao}), onde serão apresentados os algoritmos de enumeração das opções de transferências e de decisão sobre quais devem ser executadas.

\section{Algoritmo de Tomada de Decisão \label{sec:AlgoritmoTomadaDecisao}}


A definição das manobras a serem executadas para transferir consumidores para os alimentadores vizinhos não é tão trivial quanto isolar o defeito com a abertura de um equipamento e religar o equipamento atuado. Inicialmente são definidas as chaves que se localizam após o defeito. Para isso, deve se levar em consideração o equipamento que atuou ou o equipamento manobrado, no caso de existirem equipamentos atravessados pela corrente de curto-circuito. Tal equipamento é denominado como equipamento de origem, pois é ele quem marca o inicío da área defeituosa.
% A enumeração das manobras de transferência, possui uma chave de origem, a qual indica o limite do defeito a montante, ou seja, a chave utilizada para isolar o defeito do restante da rede a montante, seja pelo próprio desarme do equipamento ou pela manobra das chaves sinalizadas pela corrente de curto (etapas \ref{fig:Fluxograma_decisao}-c e \ref{fig:Fluxograma_decisao}-d do método de seleção de configurações).
O algoritmo que será apresentado aqui parte de tal equipamento de origem e procura as manobras a jusante para transferir os consumidores localizados após a área afetada para os alimentadores vizinhos.

Para exemplificar a enumeração completa de todas as manobras, sem ainda utilizar o algoritmo, será utilizada a rede da Figura \ref {fig:Exemplo_transferencia} que se encontra na seção \ref{sec:modelagem_problema}, onde o equipamento de origem tem a cor amarela e o estado aberto, uma vez que pode ter sido desarmado pela corrente de curto-circuito do defeito no primeiro trecho  (Origem - CH1-A), os equipamentos NF estão em verde e os equipamentos NA em vermelho. Todos equipamentos apresentados são telecomandados e possuem um estado de comunicação bom, ou seja, qualquer um deles pode ser utilizado para transferir os consumidores afetados pela interrupção para um alimentador vizinho.

Para encontrar o limite final (jusante) da área defeituosa, a rede é percorrida de cada chave telecomandada de fronteira do alimentador afetado até o equipamento de origem. Se não existirem outras chaves NF entre a chave de fronteira (NA) e o equipamento de origem, não existe nenhuma transferência possível usando tal chave. Se existir pelo menos um equipamento, então existe uma possibilidade de transferência.


Com isso é possível descobrir que o defeito se encontra após o equipamento Origem e antes dos demais equipamentos NF (verde), uma vez que nenhum deles foi sinalizada pela corrente de curto-circuito. Com base nisso, é possível de executar as seguintes manobras de transferência de carga. A lista completa de possibilidades de manobras está enumerada a seguir. Essa lista não foi gerada pelo algoritmo de tomada de decisão.

\begin{enumerate}
  \item CH 1-A <-> NA-1
  \item CH 1-A <-> NA-2
  \item CH 1-B <-> NA-1
  \item CH 2-B <-> NA-2
  \item Combinação do item 1 e 4
  \item Combinação do item 2 e 3
  \item Combinação do item 3 e 4
\end{enumerate}

Nessa lista são apresentadas opções que transferem todos consumidores para os alimentadores vizinhos (1,2,5,6) e também a transferência parcial dos consumidores (3,4,7). As transferências parciais podem ser úteis em períodos de grande consumo de carga no qual os alimentadores vizinhos podem não suportar toda carga que deveria ser transferida sem que isso viole alguma das restrições. As manobras são divididas em níveis, sendo o nível 1 das primeiras chaves após o equipamento de origem (manobras 1 e 2) as de nível 2 (3 e 4) e as demais são combinações das manobras anteriores.

Para uma rede que contenha poucos nós e chaves, como a apresentada na Figura \ref{fig:Exemplo_transferencia}, a enumeração de todas possibilidade é viável, mas com um aumento do número de equipamentos e de níveis, a enumeração de todas possibilidades já começa a não ser tão trivial. Além disso, a quantidade de possibilidades de manobras cresce muito, sendo que para cada manobra é necessária a simulação da aplicação de tal manobra, o que demanda um grande tempo computacional. Tais circunstâncias dificultam a viabilidade do seu uso para operações em tempo real.

Para não enumerar todas as possibilidades de manobras, foi desenvolvido um algoritmo que escolhe quais manobras que devem ser executadas de maneira mais eficiente, enumerando o menor número possível das mesmas. Tal algoritmo de escolha das manobras, já leva em consideração a função objetivo e as restrições quando está gerando o conjunto de manobras a serem executados, assim a saída do algoritmo é lista das manobras que podem ser executadas automaticamente pelo SCADA.

Antes de apresentar o algoritmo, será apresentado aqui uma visão geral acerca do seu funcionamento. Basicamente o algoritmo tenta transferir os consumidores usando as chaves mais próximas ao equipamento de origem (nível 1) e caso não consiga, avança para o próximo nível (2) e tenta novamente. No exemplo anterior não se aplica descer para mais níveis pois o exemplo possui apenas 2 níveis, mas para outros casos o algoritmo pode descer ainda mais nos níveis até encontrar uma opção válida ou não existir mais opções. Esse tipo de chamada pode ser implementada num algoritmo recursivo, como será apresentado a seguir. 

Nesses níveis, o método pode retornar ao primeiro nível caso encontre alguma transferência parcial dos consumidores. Para cada nível são testados todos os equipamentos NF e para cada um deles são testadas todas as possibilidades de transferência com as chaves NA. Em comparação com a topologia apresentada na Figura \ref{fig:Exemplo_transferencia}, no primeiro nível são enumeradas as manobras 1 e 2. Caso existam mais de uma manobra válida  de transferência (sem violar nenhuma restrição), é escolhida a que tem um melhor valor da função objetivo, ou seja, a que restabelece mais consumidores.

Se existir pelo menos uma manobra válida para cada equipamento NF do primeiro nível, então todos os consumidores após o defeito podem ser transferidos e as manobras podem ser enviadas ao SCADA. Esse é o melhor caso onde apenas as manobras do primeiro nível foram simuladas, ou seja, apenas as manobras 1 e 2 foram simuladas, sendo que somente uma delas poderá ser executada automaticamente.

Caso não seja possível transferir os consumidores usando os equipamentos NF de primeiro nível devido a violação de alguma restrição, o algoritmo passa para o próximo nível (2) e testa as possibilidades desse nível. A enumeração das manobras desse segundo nível é feita  da mesma forma como foi feita no nível anterior (1) e usando a topologia de exemplo, o algoritmo agora simularia as manobras 3 e 4.

A partir desses próximos níveis (incluindo o segundo), o algoritmo tentará aplicar (executar dentro da simulação) apenas a melhor transferência e irá retornar ao primeiro nível de onde irá tentar transferir o restante dos consumidores sem considerar as chaves utilizadas nas  manobras aplicadas. Se ainda assim não for possível transferir os consumidores do primeiro nível, o algoritmo irá novamente tentar transferir os consumidores dos próximos níveis repetindo o mesmo procedimento. No momento que não houver mais manobras nem níveis para avançar, o procedimento oferece as manobras aplicadas como sendo as manobras a serem executadas pelo SCADA.

Antes de apresentar o algoritmo que define as manobras a serem executas, é apresentado o método que aplica a melhor transferência de uma lista de transferências válidas. O método \textit{ApliqueMelhorManobra}, mostrado no Algoritmo \ref{alg:AplicaMelhor}, apenas escolhe a transferência com maior número de consumidores (linhas 3 e 4) ou, caso duas manobras possuam o mesmo número de consumidores restabelecidos, escolhe a que possui um menor carregamento (linhas 5 e 6). No final (linha 9) a manobra é aplicada (executada na simulação, não enviada ao SCADA) e os equipamentos utilizados nesta manobra são marcados para que não sejam utilizados em outras transferências da simulação. Por fim a melhor transferência é retornada.

\begin{algorithm}[htb]
\caption{{ApliqueMelhorManobra(op)}\label{alg:AplicaMelhor}}
\begin{algorithmic}[1]

\STATE $melhor \leftarrow op[1]$
\FORALL {$\alpha \in$ op}
    \IF {$\alpha.Consumidores > melhor.Consumidores$}
      \STATE $melhor \leftarrow \alpha $
    \ELSIF {($\alpha.Consumidores = melhor.Consumidores$ E\\\hspace{4em} $\alpha.Carregamento < melhor.Carregamento$)}
      \STATE $melhor \leftarrow \alpha $
    \ENDIF
  \ENDFOR
\STATE Aplique manobra (melhor)
\RETURN $melhor$
\end{algorithmic}
\end{algorithm}

O método de seleção de manobras está definido no Algoritmo \ref{alg:encontraManobras}. O algoritmo recursivo é denominado \textit{EncontraManobras} e recebe dois equipamentos, o $EqAtual$ que é o equipamento que está sendo processado e o $EqOrigem$ que é o equipamento de origem do defeito. A medição dos níveis é através da comparação de ambos equipamentos, sendo que sabe-se que o procedimento está no primeiro nível quando ambos são iguais. Com esses dois equipamentos o algoritmo não precisa contar os níveis, uma vez que apenas é necessário saber se o equipamento atual está no primeiro nível ou não. Cabe salientar que os equipamentos passados para esse algoritmo são os equipamentos do nível anterior ao que se deseja processar. O algoritmo foi definido assim para simplificar a sua construção e evitar alguns casos especiais, mas o funcionamento é o mesmo descrito anteriormente.

\begin{algorithm}[htb]
\caption{{EncontraManobras(EqAtual, EqOrigem)}\label{alg:encontraManobras}}
\begin{algorithmic}[1]
\STATE $manVld\leftarrow \emptyset$
\STATE $manLst \leftarrow \emptyset$
\FORALL {$\beta \in$ Equipamentos NF a frente de EqAtual}
\STATE $op \leftarrow \emptyset$
\STATE $Ts \leftarrow$ Lista de possíveis transferências usando $\beta$
\IF {$Ts$ NÃO é vazio}
  \FORALL {$t \in Ts$}
    \STATE {Simule a manobra $t$}
    \IF {$t$ é Válida}
      \STATE $op \leftarrow t\; \cup\; op$
    \ENDIF
  \ENDFOR
  \IF {$op$ é Vazio}
    \STATE $manVld\leftarrow manVld\; \cup\; EncontraManobras(\beta, EqOrigem)$
  \ELSE
    \IF {$EqAtual \neq EqOrigem$}
	\STATE $manLst \leftarrow manLst\; \cup\; op$
    \ELSE
	\STATE $manVld\leftarrow manVld\; \cup\; ApliqueMelhorManobra(op)$
    \ENDIF
  \ENDIF
\ENDIF
\ENDFOR
\IF {$EqAtual \neq EqOrigem$ \textbf{E} (manVld ou manLst não são vazios)}
	\STATE $manVld\leftarrow manVld\; \cup\; ApliqueMelhorManobra(manLst)$
	\STATE $manVld\leftarrow manVld\; \cup\; EncontraManobras(EqOrigem, EqOrigem)$
\ENDIF
\RETURN $manVld$
\end{algorithmic}
\end{algorithm}

A variável $manVld$ é o conjunto que contém todas as manobras válidas a serem executas e é inicializado vazio. A lista de manobras do nível atual $manLst$  é utilizada apenas nos níveis a frente do primeiro e também é inicializado como um conjunto vazio. Da linha 3 até a linha 23 o algoritmos itera sobre a lista de equipamentos a frente do equipamento atual. Caso não exista nenhum equipamento, a execução termina sem oferecer nenhuma manobra, uma vez que não existe nenhuma opção de transferência ($manVld$ e $manLst$ serão vazios).

Para cada equipamento NF ($\beta$), o algoritmo obterá uma lista de opções de transferência ($Ts$). Nessa lista $TS$ estão contidas as transferências usando o equipamento NF $\beta$ e as chaves telecomandas de fronteira com os alimentadores vizinhos. Se algum equipamento, incluindo $\beta$, já foi utilizado em outra manobra que foi aplicada pelo método \textit{ApliqueMelhorManobra}, essa manobra não será incluída na lista $Ts$. Se existir pelo menos uma opção de transferência, o algoritmo executa as simulações e adiciona ao conjunto $op$ apenas as manobras válidas (linhas 7 até 12). As simulações são a aplicação da manobra $t$ e o armazenamento dos valores necessários para comparação posterior, como consumidores transferidos, carregamentos e queda de tensão.

Se $op$ for vazio, significa que nenhuma das transferências contidas em $Ts$ são válidas, ou seja, todas violaram pelo menos uma das restrições impostas. Nesse caso o algoritmo é aplicado no próximo nível (linha 14) e o resultado de tal aplicação é adicionado ao conjunto de manobras a serem aplicadas. A chamada a função na linha 14 passa como argumentos de EqAtual o equipamento NF ($\beta$) do qual as transferências estavam sendo testadas e o equipamento EqOrigem é passado como ele mesmo.

Existindo opções de manobras válidas, a melhor delas será escolhida (linhas 16-20). Caso o método não esteja no primeiro nível ($EqAtual \neq EqOrigem$), todas opções de manobra do conjunto $op$ são adicionas à lista de manobras do nível atual (linha 17). Caso o algoritmo esteja sendo aplicado no primeiro nível ($EqAtual = EqOrigem$), a melhor manobra para o equipamento $\beta$ é escolhida e aplicada à simulação com uso do método \textit{ApliqueMelhorManobra} \ref{alg:AplicaMelhor} e então é colocada na lista de manobras válidas para ser executada diretamente.

%
% Com a melhor transferência escolhida, o algoritmo de busca das manobras \ref{alg:encontraManobras} adiciona tal manobra a lista de manobras a serem executadas (linha 15). Nesse ponto o algoritmo avalia se ele se encontra no primeiro nível ou não. Isso é feito comparando os parâmetros EqAtual e EqOrigem. Se eles forem diferentes significa que o algoritmo está processando um nível diferente do primeiro e como foi encontrada uma manobra válida, ele deve voltar para o primeiro nível para reavaliar as transferências daquele nível. Para isso o método é chamado o método passando ambos parâmetros, EqAtual e EqOrigem, são atribuídos com o o valor do EqOrigem na linha 17.

Após enumerar todas as possibilidades de transferências do nível atual, o algoritmo agora verifica se ele se encontra no primeiro nível ou não, e se ele necessita retornar para o primeiro nível para tentar novas transferências. Isso é feito na linha 24 onde é testado se o nível do equipamento sendo processador ($EqAtual$) é diferente do equipamento do primeiro nível ($EqOrigem$). Também é verificado se existem outras transferências válidas a serem executadas ou transferências no nível atual. Se o nível atual não for o primeiro mas não existirem transferências, sejam válidas ou a serem executadas, significa que todas as transferências possuem alguma restrição e não foi possível transferir parte da carga para algum alimentador vizinho. Se o algoritmo já está num nível diferente do primeiro, significa que não existiam transferências no primeiro nível e o mesmo avançou para tentar transferir parte da carga e assim poder retornar e tentar transferir novamente os consumidores do primeiro nível. Assim, se não existirem transferências válidas nos níveis a frente do primeiro,
não há a necessidade de tentar transferir os consumidores do primeiro nível.

Caso existam possibilidades no nível atual, é necessário aplicar apenas a melhor delas e retornar ao primeiro nível para tentar novamente transferir os consumidores. Se existirem manobras a serem executadas, provenientes de outros níveis, as mesmas não podem ser perdidas, assim o conjunto de manobras válidas passa a ser a união delas juntamente com o a melhor manobra do nível atual (linha 25). Na linha 26 o algoritmo retorna ao primeiro nível e une as manobras encontradas lá com as manobras válidas atuais.

Utilizando a rede da Figura \ref{fig:Exemplo_transferencia}, será apresentado um exemplo de aplicação do algoritmo. Para questão de desempate entre as manobras, caso o número de consumidores restabelecidos ser igual entre as possibilidades, será considerado que as transferências que  utilizam a chave NA-1 possuem um carregamento menor.

O início do procedimento é dado pela chamada do algoritmo \textit{EncontraManobras} (\ref{alg:encontraManobras}) passando como parâmetro inicial o equipamento ``Origem'' tanto para EqAtual quanto EqOrigem. O algoritmo então irá testar todos os equipamentos NF que se encontram a frente do equipamento atual (``Origem''). O único equipamento a frente de tal equipamento é ``CH1-A'' e agora o algoritmo irá  enumera as possibilidades de transferência utilizando tal equipamento (linha 5). São possíveis duas manobras com o equipamento ``CH1-A'': ``CH1-A - NA-1'' e ``CH1-A - NA-2''. As manobras são simuladas e, se não violarem nenhuma restrição, são colocadas na lista opções válidas (linhas 7 à 11).

Considerando que ambas manobras são válidas, o algoritmo então escolhe a de menor carregamento (a que utiliza ``NA-1''), que é então adicionada ao conjunto de manobras (linha 19), uma vez que os parâmetros EqAtual e EqOrigem são iguais (``Origem''). Por essa mesma razão, o algoritmo não irá executar os passos nas linhas 25 e 26. Ao final, a lista de manobras a serem realizadas é retornada, nesse caso contendo a manobra ``CH1-A - NA-1''.

Caso as manobras do primeiro nível não possam ser aplicadas, a lista de opções válidas ficará vazia e o algoritmo irá passar para a linha 14, onde irá avançar para o próximo nível, passando o equipamento atual (``CH1-A'') como equipamento atual e o próprio equipamento EqOrigem como seu valor de parâmetro. Como as chamadas estão sendo feitas de forma recursiva, os algoritmos referenciados pela sua ordem de chamada. Na segunda chamada do algoritmo, o algoritmo agora irá enumerar os equipamento NF a frente do equipamento atual (``CH1-A''), para cada um deles serão enumeradas as possibilidades de transferência, e ao final será escolhida apenas a melhor transferência desse nível.

O primeiro equipamento enumerado é ``CH1-B'' que possui apenas uma transferência com o equipamento NA-1, que será considerada válida. Como a segunda chamada do algoritmo não está no primeiro nível (EqAtual é diferente de EqOrigem), o algoritmo escolhe a melhor manobra e adiciona à lista de manobras do nível atual (linha 17). Nota-se que é utilizado o método EscolhaMelhorManobra, uma vez que a manobra não deve ainda ser aplicada. A segunda chamada do algoritmo agora passa para o próximo equipamento NF (``CH2-B''), o qual também possui apenas uma transferência utilizando o equipamento ``NA-2'', a qual será considerada válida. Essa manobra também será adiciona à lista de manobras do nível atual (linha 17). Não tendo mais equipamento NF, a segunda chamada do algoritmo agora escolhe a melhor manobra do nível atual (linha 25) e volta para o primeiro nível (linha 26). Considerando que a manobra ``CH1-B - NA-1'' é a melhor, ela então é aplicada e adicionada ao conjunto de manobras a serem executadas.

A terceira chamada do algoritmo na linha 26 na segunda chamada do algoritmo, retorna ao primeiro nível, mas agora a enumeração das manobras não irá considerar a transferência utilizando o equipamento ``NA-1'', uma vez que a manobra ``CH1-B - NA-1'' no segundo nível foi aplicada e utilizava aquele equipamento. Dessa forma, sobrou apenas a manobra ``CH1-A - NA-2'' que agora será considerada válida uma vez que parte da carga já foi transferida com a manobra ``CH1-B - NA-1''. Sendo a manobra válida, ela é então retornada como executável encerrando a terceira chamada do algoritmo.

Na segunda chamada do algoritmo, a manobra retornada pela terceira chamada do algoritmo (``CH1-A - NA-2'') é acrescentada ao conjunto de manobras a serem executados, ficando o conjunto composto pelas manobras \{`CH1-B - NA-1'', ``CH1-A - NA-2''\}, o
qual é retornado ao final da segunda execução. Voltando a primeira execução do algoritmo, as manobras retornadas da chamada do próximo nível (linha 14) são adicionadas ao conjunto de manobras executáveis, que estava vazio antes disso. Não existindo mais nenhum equipamento NF e estando no primeiro nível, a execução do algoritmo termina retornando as manobras \{``CH1-B - NA-1'', ``CH1-A - NA-2''\} para serem executadas, na ordem que elas estão no conjunto, pelo SCADA. Esse envio corresponde ao passo \ref{fig:Fluxograma_decisao}-f da metodologia de escolha das chaves.

Maiores detalhes sobre os resultados que o algoritmo oferece, estarão melhor apresentados no capítulo \ref{cap:casosestudos}, onde são apresentados casos de aplicação da metodologia em redes reais. Vale ressaltar que o número total de transferências simuladas nunca será completo, uma vez que dentre as transferência a partir do segundo nível apenas uma é escolhida para ser testada com as manobras do primeiro nível. Como no exemplo de aplicação descrito acima, que não teve uma simulação da manobra usando os equipamentos ``CH1-A - NA-1'' após a aplicação da manobra ``CH2-B - NA-2''.

% A tentativa inicial de transferir os consumidores usando os equipamento NF do primeiro nível (CH1-A), gerando as manobras 1 e 2, e nenhuma das manobras era válida (ambas violavam alguma das das restrições), elas não podem ser executas, assim o algoritmo desce para o segundo nível que tem as manobras 3 e 4 como correspondentes. Caso ambas manobras possam ser executas, é escolhida apenas a melhor delas e o método retorna para as manobras do nível 1. Caso a manobra escolhida no segundo nível seja a manobra 3 (equipamentos ``CH 1-B'' e ``NA-1''), agora o algoritmo irá simular apenas a manobra 2, uma vez que a chave ``NA-1'' que compõem a manobra 1 já foi utilizada na manobra 3.
%
% Se agora for possível de transferir usando a manobra 2 sem que isso viole nenhuma restrição, essa manobra é colocada junto com a manobra 3 para ser executada. Caso a manobra 2 ainda apresentar violações nas restrições, o algoritmo irá avançar um nível (2) e  tentará executar a manobra 4. Se não houver restrições nessa transferência, o algoritmo volta no nível 1, sendo que agora não existem mais transferências válidas, uma vez que todas possibilidades do primeiro nível usam equipamentos NA que já foram utilizados nas manobras aceitas (3 e 4), então o algoritmo encerra e devolve a lista de manobras que podem ser executadas.
  %Usando 2 pares de chaves foi possível restabelecer todos consumidores após o defeito



% Alg(EQ, EqOrigem)
% m
% para cada equipamento eq a frente de EQ
%   op <- \empty
%   Ts <- lista possíveis transferências usando eq
%   Se TS é vázio {
%     para cada t em Ts faça
%       simule a transferência(t)
%       Se (t é Válida)
% 	op <- op + t
%     fim para
%     se (op = \empty){
% 	m <- Alg(eq, EqOrigem)
%     }senão{
% 	m <- m + Escolhe a melhor (op)
% 	se (EQ != EqOrigem)
% 	    m <- m + Alg (EqOrigem, EqOrigem)
%     }
%   }
% fim para
%
% retorn m


% Para os próximos níveis, incluindo o nível 2, a escolha das manobras não termina quando existe uma manobra. Se existir a possibilidade de aplicar uma manobra desses níveis, essa manobra é marcada para ser apicada e o algoritmo volta para o primeiro, mas não considera as chaves utilizadas nessa manobra. Esse comportamento do algoritmo permite que se não é possível aplicar uma manobra de um nível, ele desce um nível para tentar transferir menos consumidores, e assim não violar as restrições além de reduzir a carga que seria que deve ser transferida do nível 1. Se não existir nenhuma transferência válida o algoritmo iria para o próximo nível ou, caso não existisse mais nenhum equipamento NF depois desse nível, então não existiriam manobras factíveis para transferir.



% Inicialmente são tentadas as transferências que usam a chave mais próxima ao defeito (CH 1-A), nesse caso as transferências 1 e 2. Caso ambas permitam transferir sem violar nenhuma restrição, é escolhida a manobra que apresenta um melhor valor da função objetivo. Se nenhuma delas satisfazer as restrições, então é tentada a transferência usando as próximas chaves mais próximas do defeito (CH 1-B e CH 2-B), as transferências 3 e 4, procedendo da mesma forma na escolha de qual executar. Se ainda assim houver violações em todas tentativas, é testada as próximas chaves mais perto da área afetada.
%
% A partir do segundo nível de chaves próximas ao defeito, nesse caso as chaves CH 1-B e CH 2-B, se existir a possibilidade de executar alguma das transferências testas sem comprometer nenhuma restrição, é escolhida a melhor dentre as opções e ela é aplicada, logo após as tentativas de transferência são reiniciadas a partir das chaves mais próximas ao defeito, considerando que as transferências escolhidas já foram aplicadas (chaves NA usadas fazem mais parte das opções). Essa metodologia permite que, se não for possível transferir toda carga, então parte dela será transferida para um alimentador e o restante, que será uma carga reduzida pela primeira transferência, é testada novamente gerando assim as combinações 5, 6 e 7.



% As escolhas das funções objetivo e restrições são de extrema importância
% para o processo de restabelecimento de energia elétrica. Quando tratamos do problema de reconfiguração em um estado de contingência, podemos considerar que é desejado reduzir a área afetada pelo defeito (minimizar o número de consumidores afetados) e também é esperado um número de manobras reduzido, uma vez que essas modificações são temporárias e será necessário retornar a rede ao estado anterior após a correção dos defeitos\cite{Garcia2005}.
%
% Ao restabelecer os consumidores usando outro alimentador, deve-se tomar cuidado para não deixar a rede operando com algum equipamento de proteção sobrecarregado, tanto do alimentador defeituoso como dos alimentadores que irão receber mais carga, uma vez que isso pode levar a um desarme do mesmo em caso de um elevação inesperada da carga. Os níveis de queda de tensão também devem ser observados de modo que eles fiquem dentro de um limite aceitável. Quando o caso do restabelecimento acontecer dentro do mesmo alimentador (área restabelecida antes do defeito), nenhum equipamento será sobrecarregado, uma vez que houve apenas uma redução de carga em relação a operação normal. Quanto a sobrecarga dos elementos da rede elétrica (condutores) é aceitável uma sobrecarga por ser uma situação provisória.
%
% % \textbf{Como restrições, os principais fatores são operar as redes sem sobrecarga
% % nos elementos elétricos, sem violar os ajustes de proteção e a queda de tensão
% % admissível nas redes primárias. Normalmente, as restrições de não permitir violação
% % dos ajustes de proteção e da queda de tensão admissível nos alimentadores são
% % definidas como rígidas. Por outro lado, a sobrecarga nos elementos pertencentes às
% % redes elétricas é flexibilizada, por tratar-se de uma situação provisória, ou seja, até
% % que o defeito seja sanado, para retornar a configuração de operação em regime
% % normal. Assim, se aceita um pequeno percentual de sobrecarga nos elementos
% % elétricos.}
%
% Com base nessas considerações, definiram-se as seguintes funções
% objetivo e restrições a serem utilizadas nas análises das reconfigurações da rede
% em situações de contingências:
%
% Funções Objetivo:
% \begin{enumerate}
% \item restabelecer o número máximo de consumidores;
% \item restabelecer a quantidade máxima de energia elétrica;
% \item realizar o número mínimo necessário de operações de comutação para as transferências de carga;
% \end{enumerate}
%
%
% A análise das funções objetivo é executada quando existem várias manobras que podem ser executadas sem exceder nenhuma restrição.
%
%
% \section{Metodologia proposta para operação automática dos equipamentos}
% Tendo a metodologia de definição das manobras de restabelecimento, as restrições e as funções objetivo bem definidas, fica fácil agregar esses métodos a possibilidade de enviar comandos para os equipamentos telecomandados e ter uma operação automática e autônoma da rede de distribuição.
%
% A grande vantagem desse método é que ele por si só descobre as possibilidades de transferência, ou seja, não existe um cadastro prévio das manobras do tipo 'se acontecer um defeito após a chave X, opere as chaves Z e Y', somente sendo necessário cadastras as chaves telecomandadas do sistema e a comunicação com o SCADA. Isso permite o uso dessa metodologia em diferentes topologias de rede de modo que ela irá definir as manobras a serem executadas de forma automática.
%
% Para a operação das chaves os comandos de abertura e fechamento das mesmas é enviado ao sistema supervisório, sendo que para cada par de chaves, primeiro é enviado o comando de abertura da chave que irá isolar o defeito, se o mesmo falhar (erro de comunicação), o SCADA irá rejeitar o comando e a manobra desse par de chaves será abortada. Se houverem mais manobras elas podem continuar se alguns critérios forem satisfeitos como por exemplo:
% \begin{itemize}
%     \item A manobra que falhou é fechar uma chave;
%     \item A manobra que falhou é de abrir, mas a chave encontra-se a montante da chave que será aberta;
% \end{itemize}
%
%
%
% % \textbf{telecomandados para restabelecimento de energia elétrica
% % A seguir é apresentada a metodologia proposta para operação automática
% % dos equipamentos telecomandados para restabelecimento de energia. Para tanto,
% % será apresentada a lógica de restabelecimento considerando o exemplo hipotético
% % da rede de distribuição ilustrado na Figura \ref{fig:Exemplorede}.}
% %
% % \textbf{Considerando que a chave NF-1 (normalmente fechada) e as chaves NA
% % (normalmente aberta) da Figura \ref{fig:Exemplorede} são telecomandadas, o processo de
% % restabelecimento de energia elétrica se dá da seguinte maneira, considerando o
% % desarme do alimentador AL-1:}
% %
% % \begin{itemize}
% %  \item \textbf{Defeito a jusante da chave telecomandada NF-1: na ocorrência de defeito,
% % será sinalizado em tempo real no sistema SCADA (Supervisory Control And Data
% % Acquisition) os valores de corrente de curto-circuito medidos na chave NF-1. Neste
% % caso, assume-se que a falha ocorreu após a chave, e o sistema enviará
% % automaticamente os comandos de abrir a chave telecomanda NF-1 e de religar o
% % alimentador AL-1, restabelecendo a energia para os consumidores a montante da
% % chave. Como o tempo para abrir a chave, a partir do conhecimento do defeito, é
% % inferior a 3 (três) minutos, considera-se que os consumidores a montante não são
% % impactos pela falha, para fins de apuração de indicadores técnicos. Já para os
% % consumidores a jusante, será computado o tempo de reparo do defeito e
% % restabelecimento da energia.}
% %
% % \item \textbf{Defeito a montante da chave telecomandada NF-1: na ocorrência de defeito,
% % não será sinalizado no sistema SCADA os valores de corrente de curto-circuito na
% % chave NF-1. Assim, assume-se que a falha ocorreu antes da chave NF-1, e o
% % sistema enviará automaticamente os comandos de abrir a chave telecomandada NF-
% % 1 e de fechar a chave telecomandada NA-1 ou a NA-2, no sentido de transferir os
% % consumidores a jusante da chave NF-1 para outro alimentador. A verificação da
% % viabilidade técnica das transferências de carga e a definição de qual alimentador
% % receberá os consumidores são realizadas em tempo real por meio de simulações
% % computacionais. Como o tempo para transferência automática, a partir do
% % conhecimento do defeito, é inferior a 3 (três) minutos, considera-se que os
% % consumidores transferidos, a jusante da chave, não são impactos pela falha, para
% % fins de apuração de indicadores técnicos. Já para os consumidores a montante, será
% % computado o tempo de reparo do defeito e restabelecimento da energia.}
% % \end{itemize}
% %
% % \begin{figure}
% % \begin{centering}
% % \includegraphics[width=0.4\columnwidth]{img/exemploRede}
% % \par\end{centering}
% %
% % \caption{Exemplo de rede de distribuição.\label{fig:Exemplorede}}
% %
% % \end{figure}
% % \textbf{Ressalta-se que não há necessidade de pré-configurar nenhuma manobra no
% % programa e, sim, apenas do recebimento da informação de desarme de alimentador.
% % A partir desta, a ferramenta identifica os equipamentos telecomandados pertences
% % ao alimentador atingido e seus vizinhos, verificando os estados de comunicação,
% % medições e sinalização da passagem da corrente de curto-circuito (cc). De acordo
% % com a sinalização, ou não, da passagem da corrente de cc, o sistema verifica se as
% % manobras serão no sentido de isolar o defeito ou de transferir as cargas.
% % No caso de transferências, os estudos são realizados considerando uma
% % previsão de carga para três horas a frente de modo a dar mais segurança na
% % viabilidade técnica das manobras. As previsões são realizadas com base no histórico
% % de medições da semana anterior.}
%
% % \textbf{Para identificação das opções de manobra, verifica-se quais equipamentos
% % telecomandados NA possuem condições de assumir as cargas a jusante do bloco
% % sob defeito isolado, sem violar as restrições. Quando houver mais de uma opção,
% % aplica-se o método de análise multicriterial, que será detalhado no próximo item,
% % para escolha da opção mais indicada. Se todas as alternativas apresentarem
% % violação das restrições, a ferramenta verifica se há possibilidade de transferir
% % parcialmente as cargas.}
% %
% % \subsubsection{Escolha das manobras}
% % Com a definição das monobras como escolher entre elas?
